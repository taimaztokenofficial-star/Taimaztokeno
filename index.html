
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>Taimaz Token - Secure DApp</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- MetaMask -->
<script src="https://cdn.jsdelivr.net/npm/@metamask/detect-provider/dist/detect-provider.min.js"></script>

<style>
body { background:#0d0d0d; color:#fff; font-family:sans-serif; padding:20px; }
.container { max-width:450px; margin:auto; }
.card { background:#111; padding:20px; border-radius:15px; margin-bottom:20px; border:1px solid #333; }
input, button { width:100%; padding:12px; margin:10px 0; border-radius:10px; border:none; font-size:16px; }
button { background:#7b2cbf; color:white; cursor:pointer; }
button:hover { opacity:0.9; }
#copyBtn { background:#f1c40f; color:#000; font-weight:bold; }
.chatBox { background:#000; height:200px; overflow-y:auto; padding:10px; border-radius:10px; border:1px solid #333; }
</style>
</head>

<body>
<h2 style="text-align:center;">ğŸš€ Taimaz Token DApp</h2>

<div class="container">

<!-- LOGIN BOX -->
<div id="loginBox" class="card">
    <h3>ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ø§ÛŒÙ…ÛŒÙ„</h3>
    <input id="email" type="email" placeholder="Ø§ÛŒÙ…ÛŒÙ„">
    <button onclick="sendOTP()">Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯ Û¸ Ø±Ù‚Ù…ÛŒ</button>

    <input id="otp" type="text" placeholder="Ú©Ø¯ Ø§Ø±Ø³Ø§Ù„â€ŒØ´Ø¯Ù‡">
    <button onclick="verifyOTP()">ÙˆØ±ÙˆØ¯</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="card" style="display:none;">
    <h3>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</h3>
    <p id="userEmail"></p>

    <hr>

    <h4>ğŸ’¬ Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù†</h4>
    <div id="chatMessages" class="chatBox"></div>
    <input id="chatInput" placeholder="Ù¾ÛŒØ§Ù…...">
    <button onclick="sendMessage()">Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…</button>

    <hr>

    <h4>ğŸª™ Ø§ØªØµØ§Ù„ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ù¾Ø§Ù„ÛŒÚ¯Ø§Ù†</h4>
    <button onclick="connectWallet()">Ø§ØªØµØ§Ù„ MetaMask</button>
    <p id="walletAddress"></p>

    <hr>

    <h4>ğŸ“¨ Ø¯Ø¹ÙˆØª Ø¯ÙˆØ³ØªØ§Ù†</h4>
    <input id="inviteEmail" type="email" placeholder="Ø§ÛŒÙ…ÛŒÙ„ Ø¯ÙˆØ³Øª">
    <button onclick="sendInvite()">Ø§Ø±Ø³Ø§Ù„ Ø¯Ø¹ÙˆØªâ€ŒÙ†Ø§Ù…Ù‡</button>

    <hr>

    <button onclick="logout()" style="background:#e63946;">Ø®Ø±ÙˆØ¬</button>
</div>

<!-- COPY CODE BUTTON -->
<button id="copyBtn" onclick="copyCode()">ğŸ“„ Ú©Ù¾ÛŒ Ú©Ù„ Ú©Ø¯ Ø³Ø§ÛŒØª</button>

</div>

<script>
// ------------------ CONFIG ------------------
const SUPABASE_URL = "https://eljzgzirwuzztvwqmyvr.supabase.co";
const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVsanpnemlyd3V6enR2d3FteXZyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ1OTczMDYsImV4cCI6MjA4MDE3MzMwNn0.ZLzX_vR9Y7DrtdbmdgWRJeMzAt6au9hdpNm3Q42NX3Y";

const SENDGRID_API = "YOUR_REAL_SENDGRID_KEY"; // Ø¬Ø§ÛŒÚ¯Ø°Ø§Ø±ÛŒ Ú©Ù„ÛŒØ¯ ÙˆØ§Ù‚Ø¹ÛŒ SendGrid
const FROM_EMAIL = "taimaztokenofficial@gmail.com";

const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

// ------------------ OTP LOGIN ------------------
async function sendOTP(){
    let email = document.getElementById("email").value;
    if(!email) return alert("Ø§ÛŒÙ…ÛŒÙ„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†");

    let code = Math.floor(10000000 + Math.random()*90000000);

    localStorage.setItem("otpCode", code);
    localStorage.setItem("otpEmail", email);

    // Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„ ÙˆØ§Ù‚Ø¹ÛŒ
    await fetch("https://api.sendgrid.com/v3/mail/send", {
        method: "POST",
        headers: {
            "Authorization": "Bearer " + SENDGRID_API,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            personalizations:[{to:[{email}],subject:"Ú©Ø¯ ÙˆØ±ÙˆØ¯"}],
            from:{email:FROM_EMAIL,name:"Taimaz Token"},
            content:[{type:"text/plain",value:Ú©Ø¯ ÙˆØ±ÙˆØ¯: ${code}}]
        })
    });

    alert("Ú©Ø¯ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯ âœ”");
}

function verifyOTP(){
    let code = document.getElementById("otp").value;
    if(code === localStorage.getItem("otpCode")){
        document.getElementById("loginBox").style.display="none";
        document.getElementById("dashboard").style.display="block";
        document.getElementById("userEmail").innerText =
            "Ø§ÛŒÙ…ÛŒÙ„: " + localStorage.getItem("otpEmail");
        loadMessages();
    } else alert("Ú©Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª");
}

// ------------------ CHAT ------------------
async function loadMessages(){
    let { data } = await supabaseClient.from("messages").select("*").order("id");
    let box = document.getElementById("chatMessages");
    box.innerHTML = "";
    data.forEach(m => box.innerHTML += <div><b>${m.sender}</b>: ${m.text}</div>);
}

async function sendMessage(){
    let txt = document.getElementById("chatInput").value;
    if(!txt) return;

    await supabaseClient.from("messages").insert([{ sender: localStorage.getItem("otpEmail"), text: txt }]);
    document.getElementById("chatInput").value="";
    loadMessages();
}
setInterval(loadMessages, 2000);

// ------------------ WALLET ------------------
async function connectWallet(){
    const provider = await detectEthereumProvider();
    if(!provider) return alert("MetaMask Ù†ØµØ¨ Ù†ÛŒØ³Øª");

    let accounts = await provider.request({method:"eth_requestAccounts"});
    document.getElementById("walletAddress").innerText = accounts[0];
}

// ------------------ INVITE ------------------
async function sendInvite(){
    let email = document.getElementById("inviteEmail").value;
    if(!email) return alert("Ø§ÛŒÙ…ÛŒÙ„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†");

    await fetch("https://api.sendgrid.com/v3/mail/send", {
        method:"POST",
        headers:{
            "Authorization":"Bearer "+SENDGRID_API,
            "Content-Type":"application/json"
        },
        body:JSON.stringify({
            personalizations:[{to:[{email}],subject:"Ø¯Ø¹ÙˆØªÙ†Ø§Ù…Ù‡ Ø¹Ø¶ÙˆÛŒØª"}],
            from:{email:FROM_EMAIL,name:"Taimaz Token"},
            content:[{type:"text/plain",value:"Ø´Ù…Ø§ Ø¨Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡ Taimaz Token Ø¯Ø¹ÙˆØª Ø´Ø¯Ù‡â€ŒØ§ÛŒØ¯."}]
        })
    });

    alert("Ø¯Ø¹ÙˆØªâ€ŒÙ†Ø§Ù…Ù‡ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯ âœ”");
}

// ------------------ COPY CODE ------------------
function copyCode(){ navigator.clipboard.writeText(document.documentElement.outerHTML); alert("Ú©Ø¯ Ú©Ø§Ù…Ù„ Ø³Ø§ÛŒØª Ú©Ù¾ÛŒ Ø´Ø¯ âœ”"); }

// ------------------ LOGOUT ------------------
function logout(){ localStorage.clear(); location.reload(); }

// Ù†Ù…Ø§ÛŒØ´ Ø§ÙˆÙ„ÛŒÙ‡
document.getElementById("loginBox").style.display="block";
</script>
</body>
</html>
